<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Landing Page</title>
  <style>
    /* === GLOBAL RESET & BASE === */
    * { box-sizing: border-box; }
    
    body {
      background: #0D0B14;
      color: #E0E0E0;
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding-top: 40px;
    }

    /* === LAYOUT === */
    .main-content {
      margin-left: 60px;
      padding: 0 40px;
    }

    h1 {
      margin-bottom: 30px;
      font-size: 2em;
    }

    /* === SIDEBAR === */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 60px;
      background: #1A1625;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
    }

    .sidebar a {
      color: #63FFDA;
      font-size: 24px;
      margin: 16px 0;
      text-decoration: none;
    }

    .sidebar a svg {
      width: 24px;
      height: 24px;
      fill: none;
      stroke: #63FFDA;
      stroke-width: 2;
    }

    /* === QUICK ADD BUTTON === */
    .open-popup-btn {
      position: fixed;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      background: none;
      border: none;
      cursor: pointer;
      z-index: 1000;
      color: #63FFDA;
      padding: 0;
    }

    .open-popup-btn svg {
      width: 100%;
      height: 100%;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
    }

    /* === TASK INPUT SYSTEM === */
    .task-input {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 0;
      width: 100%;
    }

    .priority-select { 
      gap: 6px; 
      margin-right: 6px; 
    }

    .priority-btn { 
      width: 16px; 
      height: 16px; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
      opacity: 0.6; 
    }
    .priority-btn.selected { opacity: 1; }
    .priority-btn.low { background: #4CAF50; }
    .priority-btn.med { background: #FFC107; }
    .priority-btn.high { background: #F44336; }

    .task-input input[type="text"] {
      min-width: 0;
      width: 100%;
      font-size: 15px;
      height: 36px;
      padding: 7px 10px;
    }

    .task-input input[type="number"] {
      width: 54px;
      min-width: 0;
      font-size: 14px;
      padding: 4px 6px;
    }

    .task-input button, 
    .task-dropdown summary.options-btn {
      height: 36px;
      padding: 0 14px;
      border: none;
      border-radius: 4px;
      background: #63FFDA;
      color: #0D0B14;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
    }

    .task-input button { 
      margin-left: 8px; 
    }

    /* === DROPDOWN SYSTEM === */
    .task-dropdown { 
      position: relative; 
      margin-left: 0; 
    }

    .task-dropdown summary.options-btn { 
      list-style: none; 
      display: flex; 
      align-items: center; 
      font-family: inherit; 
    }

    .task-dropdown summary::-webkit-details-marker { 
      display: none; 
    }

    .task-dropdown-content {
      position: absolute;
      top: calc(100% + 4px);
      left: unset;
      right: 0;
      background: #211D30;
      padding: 8px;
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      display: none;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      min-width: 170px;
    }

    .task-dropdown[open] .task-dropdown-content { 
      display: block; 
    }

    .task-dropdown-content label { 
      display: flex; 
      align-items: center; 
      gap: 4px; 
      color: #E0E0E0; 
      font-size: 14px; 
      margin-bottom: 2px; 
    }

    /* === SWITCH SYSTEM === */
    .switch { 
      position: relative; 
      display: inline-block; 
      width: 32px; 
      height: 18px; 
      margin-left: 6px; 
    }

    .switch input { 
      opacity: 0; 
      width: 0; 
      height: 0; 
    }

    .slider { 
      position: absolute; 
      cursor: pointer; 
      top: 0; 
      left: 0; 
      right: 0; 
      bottom: 0; 
      background: #4F4B68; 
      border-radius: 34px; 
      transition: .4s; 
    }

    .slider:before { 
      position: absolute; 
      content: ''; 
      height: 14px; 
      width: 14px; 
      left: 2px; 
      bottom: 2px; 
      background: #FFF; 
      border-radius: 50%; 
      transition: .4s; 
    }

    .switch input:checked + .slider { 
      background: #A076F9; 
    }

    .switch input:checked + .slider:before { 
      transform: translateX(14px); 
    }    /* === MODAL SYSTEM === */
    #quickAddModal {
      background: #1A1625;
      color: #E0E0E0;
      border: none;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.7);
      position: fixed;
      top: 60px;
      right: 16px;
      width: 370px;
      max-width: 95vw;
      z-index: 2000;
      display: none;
    }

    .weekly-review-modal {
      background: #1A1625 !important;
      color: #E0E0E0;
      border: none;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.7);
      padding: 32px 32px 24px 32px;
      max-width: 480px;
      width: 95vw;
      min-height: 320px;
      z-index: 3000;
      text-align: left;
    }

    .weekly-review-modal h2 {
      color: #63FFDA;
      font-size: 1.25em;
      font-weight: 600;
      margin: 0 0 18px 0;
    }

    #weeklyReviewText {
      width: 100%;
      min-height: 140px;
      background: #211D30;
      color: #E0E0E0;
      border: none;
      border-radius: 8px;
      padding: 14px 16px;
      font-family: 'Poppins', sans-serif;
      font-size: 1em;
      margin-bottom: 0;
      resize: vertical;
      box-sizing: border-box;
    }

    #weeklyReviewText::placeholder {
      color: #A0A0A0;
      opacity: 1;
    }

    #saveWeeklyReviewBtn {
      background: #63FFDA;
      color: #0D0B14;
      border: none;
      border-radius: 6px;
      padding: 8px 22px;
      font-weight: 600;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
    }

    #saveWeeklyReviewBtn:disabled {
      background: #29223a;
      color: #A0A0A0;
      cursor: not-allowed;
    }

    #closeWeeklyReviewBtn {
      background: none;
      color: #A0A0A0;
      border: none;
      border-radius: 6px;
      padding: 8px 22px;
      font-weight: 600;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
    }

    @media (max-width: 600px) {
      .weekly-review-modal { 
        padding: 18px 6vw 18px 6vw; 
      }
    }

    /* === WIDGET COMPONENTS === */
    .widget-title {
      text-align: center;
      color: #63FFDA;
      font-weight: 600;
      margin-bottom: 18px;
      font-size: 1.18rem;
    }

    .landing-timeframe-controls {
      text-align: center;
      margin-bottom: 12px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    .landing-timeframe-controls button {
      background: none;
      border: 1px solid transparent;
      color: #63FFDA;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      padding: 4px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background-color 0.2s, color 0.2s, border-color 0.2s, box-shadow 0.2s;
    }

    .landing-timeframe-controls button.active,
    .landing-timeframe-controls button.selected {
      background-color: #0D0B14;
      color: #63FFDA;
      border-color: #63FFDA;
      box-shadow: none;
    }

    .landing-timeframe-controls button:hover:not(.active):not(.selected) {
      background-color: transparent;
      color: #63FFDA;
      border-color: transparent;
      box-shadow: 0 0 8px #63FFDA;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>  <nav class="sidebar">
    <a href="Landing Page.html">
      <svg viewBox="0 0 24 24">
        <path d="M3 10L12 3l9 7v11a1 1 0 0 1-1 1h-6v-7h-4v7H4a1 1 0 0 1-1-1V10z"/>
      </svg>
    </a>
    <a href="Personal Finance Tracker.html">
      <svg viewBox="0 0 24 24">
        <polyline points="3 17 8 12 13 16 21 4" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </a>
    <a href="Productivity Tracker.html">
      <svg viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="9"/>
        <polyline points="12 7 12 12 15 15" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </a>
  </nav>

  <!-- Quick Add Task Button & Modal -->
  <button id="openQuickAddBtn" title="Quick Add Task" class="open-popup-btn">
    <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
  </button>
  <div id="quickAddModal">
    <div class="task-input">
      <div class="priority-select" id="quickPrioritySelect">
        <button class="priority-btn low selected" data-priority="low" title="Low"></button>
        <button class="priority-btn med" data-priority="med" title="Medium"></button>
        <button class="priority-btn high" data-priority="high" title="High"></button>
      </div>
      <input id="quickTaskText" type="text" placeholder="add task">
      <details class="task-dropdown">
        <summary class="options-btn">Options</summary>
        <div class="task-dropdown-content">
          <label>Time Allotted<input id="quickTimeAllotted" type="number" min="0" placeholder="hrs"></label>
          <label>Difficulty</label>
          <label class="switch">
            <input id="quickDifficulty" type="checkbox">
            <span class="slider"></span>
          </label>
          <span id="quickDiffLabel">Easy</span>
        </div>
      </details>
      <button id="quickAddConfirm">Add</button>
    </div>
  </div>

  <!-- Weekly Review Modal -->
  <dialog id="weeklyReviewModal" class="weekly-review-modal">
    <form method="dialog" style="margin:0;">
      <h2>What did you get done this week?</h2>
      <textarea id="weeklyReviewText" placeholder="add notes"></textarea>
      <div style="display:flex; justify-content:flex-end; gap:12px; margin-top:10px;">
        <button id="saveWeeklyReviewBtn" disabled style="margin-right:0;">Save</button>
        <button id="closeWeeklyReviewBtn" type="button">Close</button>
      </div>
    </form>
  </dialog>
  <div class="main-content">
    <h1>Dashboard Overview</h1>
    <div class="dashboard-widgets-row" style="display: flex; gap: 32px; margin-top: 32px;">
      <!-- Overall Performance Widget (from Productivity Tracker) -->
      <div class="widget-card" style="flex:1; background:#18142A; border-radius:18px; box-shadow:0 8px 32px 0 rgba(33,29,48,0.45); padding:28px 24px 18px 24px; min-width:0; min-height:340px; display:flex; flex-direction:column;">
        <h2 class="widget-title">Overall Performance</h2>
        <div class="timeframe-controls landing-timeframe-controls">
          <button class="timeframe-btn active" data-timeframe="day">Day</button>
          <button class="timeframe-btn" data-timeframe="week">Week</button>
          <button class="timeframe-btn" data-timeframe="month">Month</button>
          <button class="timeframe-btn" data-timeframe="year">Year</button>
        </div>
        <div style="flex:1; min-height:220px;">
          <canvas id="landingOverallPerformanceChart" style="width:100%;height:220px;"></canvas>
        </div>
      </div>

      <!-- Net Worth Placeholder Widget -->
      <div class="widget-card" style="flex:1; background:#18142A; border-radius:18px; box-shadow:0 8px 32px 0 rgba(33,29,48,0.45); padding:28px 24px 18px 24px; min-width:0; min-height:340px; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <h2 class="widget-title">Net Worth</h2>
        <div class="timeframe-controls landing-timeframe-controls">
          <button class="networth-timeframe-btn active" data-timeframe="day">Day</button>
          <button class="networth-timeframe-btn" data-timeframe="week">Week</button>
          <button class="networth-timeframe-btn" data-timeframe="month">Month</button>
          <button class="networth-timeframe-btn" data-timeframe="year">Year</button>
        </div>
        <div style="flex:1; display:flex; align-items:center; justify-content:center; color:#A0A0A0; font-size:1.2rem;">(Coming soon)</div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const openQuick = document.getElementById('openQuickAddBtn');
    const quickModal = document.getElementById('quickAddModal');
    const quickText = document.getElementById('quickTaskText');
    const quickTime = document.getElementById('quickTimeAllotted');
    const quickDiff = document.getElementById('quickDifficulty');
    const quickLabel = document.getElementById('quickDiffLabel');
    let quickPri = 'low';    // Show modal
    openQuick.addEventListener('click', () => {
      quickModal.style.display = quickModal.style.display === 'none' ? 'block' : 'none';
    });

    // Hide modal by default (on DOMContentLoaded)
    document.addEventListener('DOMContentLoaded', () => {
      quickModal.style.display = 'none';
    });

    // Hide modal when clicking outside of it
    document.addEventListener('click', (e) => {
      if (!quickModal.contains(e.target) && !openQuick.contains(e.target)) {
        quickModal.style.display = 'none';
      }
    });

    // Priority
    document.querySelectorAll('#quickPrioritySelect .priority-btn').forEach(b => b.addEventListener('click', () => {
      document.querySelectorAll('#quickPrioritySelect .priority-btn').forEach(n=>n.classList.remove('selected'));
      b.classList.add('selected'); quickPri = b.dataset.priority;
    }));    // Difficulty toggle
    quickDiff.addEventListener('change', e => quickLabel.textContent = e.target.checked ? 'Hard' : 'Easy');

    // Confirm
    document.getElementById('quickAddConfirm').addEventListener('click', () => {
      const text = quickText.value.trim(); 
      if (!text) return;
      
      const payload = { 
        type:'addTask', 
        text, 
        timeAllotted: parseInt(quickTime.value)||0,
        difficulty: quickDiff.checked?'hard':'easy', 
        priority: quickPri 
      };
      
      // Only use localStorage for cross-tab sync (no window.open)
      localStorage.setItem('productivityQuickAdd', JSON.stringify(payload));
      
      // Clear inputs and close modal
      quickText.value = '';
      quickTime.value = '';
      quickDiff.checked = false;
      quickLabel.textContent = 'Easy';
      document.querySelectorAll('#quickPrioritySelect .priority-btn').forEach(b => b.classList.remove('selected'));
      document.querySelector('#quickPrioritySelect .priority-btn.low').classList.add('selected');
      quickPri = 'low';
      quickModal.style.display = 'none';
    });

    // Close on backdrop
    quickModal.addEventListener('click', e=>{ if(e.target===quickModal) {
      quickModal.close();
      quickModal.style.display = 'none';
    }});

    // Weekly Review logic
    const oldCard = document.querySelector('.weekly-review-card');
    if (oldCard) oldCard.remove();

    const weeklyReviewModal = document.getElementById('weeklyReviewModal');
    const weeklyReviewText = document.getElementById('weeklyReviewText');
    const saveWeeklyReviewBtn = document.getElementById('saveWeeklyReviewBtn');
    const closeWeeklyReviewBtn = document.getElementById('closeWeeklyReviewBtn');

    // Enable save button only if there is text
    weeklyReviewText.addEventListener('input', () => {
      saveWeeklyReviewBtn.disabled = weeklyReviewText.value.trim() === '';
    });

    // Save review to localStorage
    saveWeeklyReviewBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const review = weeklyReviewText.value.trim();
      if (review) {
        const weekKey = `weeklyReview_${new Date().getFullYear()}_${getWeekNumber(new Date())}`;
        localStorage.setItem(weekKey, review);
        weeklyReviewText.value = '';
        saveWeeklyReviewBtn.disabled = true;
        weeklyReviewModal.close();
      }
    });

    closeWeeklyReviewBtn.addEventListener('click', () => {
      weeklyReviewModal.close();
    });

    // Helper to get ISO week number
    function getWeekNumber(d) {
      d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      const dayNum = d.getUTCDay() || 7;
      d.setUTCDate(d.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
      return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
    }

    // Show modal only on Fridays and pre-fill with saved review
    window.addEventListener('DOMContentLoaded', () => {
      const today = new Date();
      if (today.getDay() === 5) { // 5 = Friday
        const weekKey = `weeklyReview_${today.getFullYear()}_${getWeekNumber(today)}`;
        const savedReview = localStorage.getItem(weekKey) || '';
        weeklyReviewText.value = savedReview;
        saveWeeklyReviewBtn.disabled = savedReview.trim() === '';
        // Only show the modal if there are no saved notes for this week
        if (!savedReview.trim()) {
          weeklyReviewModal.showModal();
        }
      }
    });

    // --- LANDING PAGE OVERALL PERFORMANCE CHART ---
    const ctxLandingOverall = document.getElementById('landingOverallPerformanceChart').getContext('2d');
    const gradientLandingCyan = ctxLandingOverall.createLinearGradient(0, 0, 0, 300);
    gradientLandingCyan.addColorStop(0, 'rgba(99, 255, 218, 0.4)');
    gradientLandingCyan.addColorStop(1, 'rgba(99, 255, 218, 0)');

    const landingOverallChart = new Chart(ctxLandingOverall, {
      type: 'bar',
      data: {
        labels: [],
        datasets: [
          {
            type: 'bar',
            label: 'Low Assigned',
            data: [],
            backgroundColor: '#73BFFF',
            stack: 'assigned',
            borderRadius: 6,
            borderSkipped: 'bottom',
            barPercentage: 0.5
          },
          {
            type: 'bar',
            label: 'Med Assigned',
            data: [],
            backgroundColor: '#FFF000',
            stack: 'assigned',
            borderRadius: 6,
            borderSkipped: 'bottom',
            barPercentage: 0.5
          },
          {
            type: 'bar',
            label: 'High Assigned',
            data: [],
            backgroundColor: '#FF6B6B',
            stack: 'assigned',
            borderRadius: 6,
            borderSkipped: 'bottom',
            barPercentage: 0.5
          },
          {
            type: 'line',
            label: 'Tasks Assigned',
            data: [],
            borderColor: '#A0A0A0',
            borderDash: [6,6],
            fill: false,
            tension: 0.4,
            pointRadius: 0,
            yAxisID: 'y'
          },
          {
            type: 'line',
            label: 'Tasks Completed',
            data: [],
            borderColor: '#63FFDA',
            backgroundColor: gradientLandingCyan,
            fill: true,
            tension: 0.4,
            pointRadius: 0,
            pointBackgroundColor: '#63FFDA',
            pointBorderColor: '#1A1625',
            pointHoverRadius: 6,
            yAxisID: 'y'
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        elements: { bar: { borderRadius: 8, borderSkipped: false } },
        interaction: { mode: 'index', intersect: false },
        scales: {
          x: { stacked: true, grid: { display: false }, ticks: { color: '#A0A0A0' } },
          y: {
            beginAtZero: true,
            stacked: false,
            grid: { display: true, color: 'rgba(79, 75, 104, 0.3)', drawBorder: false },
            ticks: { color: '#A0A0A0', stepSize: 1 }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            enabled: true,
            mode: 'index', intersect: false,
            displayColors: false,
            backgroundColor: '#211D30', titleColor: '#FFF', bodyColor: '#FFF', padding: 8,
            borderColor: '#63FFDA', borderWidth: 1,
            callbacks: {
              title: items => {
                const label = items[0].label;
                const now = new Date();
                if (landingChartRange === 'year') return label + ' ' + now.getFullYear();
                if (landingChartRange === 'month') return now.toLocaleString('default', { month: 'long' }) + ' ' + label + ', ' + now.getFullYear();
                return label;
              },
              label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y}`
            }
          }
        }
      }
    });

    // --- AGGREGATION LOGIC FOR LANDING PAGE OVERALL PERFORMANCE ---
    function aggregateLanding(range) {
      const tasks = JSON.parse(localStorage.getItem('productivityTasks')||'[]');
      const now = new Date();
      const currentYear = now.getFullYear();
      const currentMonth = now.getMonth();
      let labels, low, med, high, completed, assignedSum;
      
      if (range === 'year') {
        labels = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        low = Array(12).fill(0); med = Array(12).fill(0); high = Array(12).fill(0); completed = Array(12).fill(0);
        tasks.forEach(t => {
          const created = t.created ? new Date(t.created) : null;
          const completedAt = t.completedAt ? new Date(t.completedAt) : null;
          if (created && created.getFullYear() === currentYear) {
            const m = created.getMonth();
            if (t.priority==='low') low[m]++; if (t.priority==='med') med[m]++; if (t.priority==='high') high[m]++;
          }
          if (completedAt && completedAt.getFullYear() === currentYear) {
            const m = completedAt.getMonth();
            completed[m]++;
          }
        });
        assignedSum = low.map((_,i)=>low[i]+med[i]+high[i]);
      } else if (range === 'month') {
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        labels = Array.from({ length: daysInMonth }, (_, i) => (i + 1).toString());
        low = Array(daysInMonth).fill(0); med = Array(daysInMonth).fill(0); high = Array(daysInMonth).fill(0); completed = Array(daysInMonth).fill(0);
        tasks.forEach(t => {
          const created = t.created ? new Date(t.created) : null;
          const completedAt = t.completedAt ? new Date(t.completedAt) : null;
          if (created && created.getFullYear() === currentYear && created.getMonth() === currentMonth) {
            const d = created.getDate() - 1;
            if (t.priority==='low') low[d]++; if (t.priority==='med') med[d]++; if (t.priority==='high') high[d]++;
          }
          if (completedAt && completedAt.getFullYear() === currentYear && completedAt.getMonth() === currentMonth) {
            const d = completedAt.getDate() - 1;
            completed[d]++;
          }
        });
        assignedSum = low.map((_,i)=>low[i]+med[i]+high[i]);
      } else if (range === 'week') {
        // ISO week: Monday-Sunday
        const day = now.getDay(), iso = (day+6)%7;
        const start = new Date(now); start.setDate(now.getDate()-iso); start.setHours(0,0,0,0);
        const end   = new Date(start); end.setDate(start.getDate()+6); end.setHours(23,59,59,999);
        labels = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
        low = Array(7).fill(0); med = Array(7).fill(0); high = Array(7).fill(0); completed = Array(7).fill(0);
        tasks.forEach(t => {
          const created = t.created ? new Date(t.created) : null;
          const completedAt = t.completedAt ? new Date(t.completedAt) : null;
          if (created && created >= start && created <= end) {
            const i = (created.getDay()+6)%7;
            if (t.priority==='low') low[i]++; if (t.priority==='med') med[i]++; if (t.priority==='high') high[i]++;
          }
          if (completedAt && completedAt >= start && completedAt <= end) {
            const i = (completedAt.getDay()+6)%7;
            completed[i]++;
          }
        });
        assignedSum = low.map((_,i)=>low[i]+med[i]+high[i]);
      } else { // day
        labels = Array.from({length:24},(_,i)=>`${i}:00`);
        low = Array(24).fill(0); med = Array(24).fill(0); high = Array(24).fill(0); completed = Array(24).fill(0);
        tasks.forEach(t => {
          const created = t.created ? new Date(t.created) : null;
          const completedAt = t.completedAt ? new Date(t.completedAt) : null;
          if (created && isSameDay(created, now)) {
            const h = created.getHours();
            if (t.priority==='low') low[h]++; if (t.priority==='med') med[h]++; if (t.priority==='high') high[h]++;
          }
          if (completedAt && isSameDay(completedAt, now)) {
            const h = completedAt.getHours();
            completed[h]++;
          }
        });
        assignedSum = low.map((_,i)=>low[i]+med[i]+high[i]);
      }
      return { labels, low, med, high, assignedSum, completed };
    }

    function isSameDay(a,b){ return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate(); }

    // --- Populate landing chart with productivity data from localStorage (default: year) ---
    let landingChartRange = 'year';
    function updateLandingOverallChart(range) {
      landingChartRange = range;
      const { labels, low, med, high, assignedSum, completed } = aggregateLanding(range);
      landingOverallChart.data.labels = labels;
      landingOverallChart.data.datasets[0].data = low;
      landingOverallChart.data.datasets[1].data = med;
      landingOverallChart.data.datasets[2].data = high;
      landingOverallChart.data.datasets[3].data = assignedSum;
      landingOverallChart.data.datasets[4].data = completed;
      landingOverallChart.update();
    }
    updateLandingOverallChart(landingChartRange);

    // --- Timeframe toggle logic for UI (Net Worth only UI, no data logic) ---
    // Overall Performance toggles
    const overallBtns = document.querySelectorAll('.landing-timeframe-controls .timeframe-btn');
    overallBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        overallBtns.forEach(b => { b.classList.remove('active'); b.classList.remove('selected'); });
        btn.classList.add('active');
        updateLandingOverallChart(btn.dataset.timeframe);
      });
    });
    
    // Net Worth toggles (UI only)
    const networthBtns = document.querySelectorAll('.landing-timeframe-controls .networth-timeframe-btn');
    networthBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        networthBtns.forEach(b => { b.classList.remove('active'); b.classList.remove('selected'); });
        btn.classList.add('active');
        // No data logic yet
      });
    });
  </script>
</body>
</html>